name: Launch SSHX VM and persist disk

on:
  workflow_dispatch:

jobs:
  sshx-vm:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Create vmdata folder
        run: mkdir -p vmdata

      - name: Install sshx
        run: |
          curl -sL https://sshx.io/get | tar -xz
          sudo mv sshx*/sshx /usr/local/bin/sshx
          sshx --version

      - name: Start SSHX VM with persistent disk
        run: |
          sshx --name ptero-vm --enable-readers --shell bash --mount ./vmdata &
          sleep 10
          echo "✅ SSHX VM started — open the terminal link shown in the logs."
