name: Launch SSHX VM and persist disk

on:
  workflow_dispatch:

jobs:
  sshx-vm:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ—‚ï¸ Create persistent VM data folder
        run: mkdir -p vm-data

      - name: ğŸ”“ Install sshx
        run: |
          curl -sL https://sshx.io/get | bash
          sshx --help

      - name: ğŸš€ Launch SSHX VM
        run: |
          sshx --name ptero-vm --enable-readers &
          sleep 10

      - name: ğŸ’¾ Save VM Data to Branch
        run: |
          git config --global user.name "Auto Backup"
          git config --global user.email "actions@github.com"
          git fetch origin vm-data || git checkout --orphan vm-data
          git add vm-data
          git commit -m "ğŸ’¾ Backup VM data on $(date '+%Y-%m-%d %H:%M:%S')" || echo "Nothing to commit"
          git push -u origin vm-data
